<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the waterquality package • waterquality</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the waterquality package">
<meta property="og:description" content="waterquality">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">waterquality</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/waterquality_vignette.html">Introduction to the waterquality package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RAJohansen/waterquality/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="waterquality_vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to the waterquality package</h1>
                        <h4 class="author">Richard Johansen, Jakub Nowosad, Molly Reif, and Erich Emery</h4>
            
            <h4 class="date">2020-08-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/RAJohansen/waterquality/blob/master/../vignettes/waterquality_vignette.Rmd"><code>../vignettes/waterquality_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>waterquality_vignette.Rmd</code></div>

    </div>

    
    
<p>The main purpose of <strong>waterquality</strong> is to quickly and easily convert satellite-based reflectance imagery into one or many well-known water quality algorithms designed for the detection of harmful algal blooms or the following pigment proxies: chlorophyll-a, blue-green algae (Phycocyanin), and Turbidity. Currently, this package is able to process <a href="https://rajohansen.github.io/waterquality/reference/index.html">45 algorithms</a> for the following satellite-based imagers: WorldView-2, Sentinel-2, Landsat-8, MODIS, MERIS, and OLCI. In order to improve the aesthetics of the <code>wq_calc</code> output, we are developing a series of <code>Map_WQ</code> functions which may reduce technical barriers and simplify the complexities in selecting a map layout. Additional functionality of the package include a series of <code>extract_lm</code> functions wrap that <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/lm">“Fitting Linear Models”</a> and the <a href="http://topepo.github.io/caret/index.html">“caret”</a> packages to quickly generate crossvalidated linear model and standardized outputs (r^2, p-value, slope, intercept of the global lm model &amp; average r^2, average RMSE, average MAE of crossvalidated model) for any number of algorithm and water quality parameters combinations. It is important to note that the <code>extract_lm</code> functions require ground-truth data in order to develop the models.</p>
<p>For an example of a full research workflow, including data acquisition, image pre-processing, methods, and results please see our publication entitled<a href="https://erdc-library.erdc.dren.mil/jspui/bitstream/11681/35053/3/ERDC-EL%20TR-19-20.pdf">“Waterquality: An Open-Source R Package for the Detection and Quantification of Cyanobacterial Harmful Algal Blooms and Water Quality”</a>.</p>
<div id="algorithms" class="section level2">
<h2 class="hasAnchor">
<a href="#algorithms" class="anchor"></a>Algorithms</h2>
<p>Currently, we have a list of <a href="https://rajohansen.github.io/waterquality/reference/index.html">45 algorithms</a> that can be applied for the detection of these three metrics. Although, it is important to note that not all sensors are capable of using all algorithms due to their spectral configurations. Each of the algorithms are searchable within the package, where there is a reference to the original paper (Ex. <code>?Am092Bsub()</code>). Each algorithm is also linked to the original papers metric (chlorophyll-a, phycocyanin, Turbidity) by type, which allows users to select all algorithms for that type. The final raster images are in relative index values and are not the estimated chlorophyll-a, phycocyanin, or turbidity values. However, these relative values can be converted in to estimated concentration values using the <code>extract_lm</code> functions and ground truth measurements.</p>
</div>
<div id="water-quality-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#water-quality-functions" class="anchor"></a>Water Quality Functions</h2>
<div id="wq_calc" class="section level3">
<h3 class="hasAnchor">
<a href="#wq_calc" class="anchor"></a>wq_calc()</h3>
<p>The main function of this package is called <code><a href="../reference/wq_calc.html">wq_calc()</a></code> which calculates water quality indices by using an reflectance raster stack as an input, user-defined algorithm(s) selection, and satellite configuration selection corresponding to the following three arguments: <code>raster_stack</code>, <code>alg</code>, and <code>sat</code>.</p>
<ul>
<li>
<code>raster_stack</code> - The input reflectance image to be used in band algorithm calculation.</li>
<li>
<code>alg</code> - Determines the indices to be utilized:
<ul>
<li>Single Algorithm</li>
<li>Multiple Algorithm</li>
<li>Type of Algorithm</li>
<li>All Possible Algorithms</li>
</ul>
</li>
<li>
<code>sat</code> - Determines the appropriate spectral configuration and subsequently appropriate algorithms to be calculated from predefined list:
<ul>
<li>WorldView-2</li>
<li>Sentinel-2</li>
<li>Landsat-8</li>
<li>MODIS</li>
<li>MERIS</li>
<li>OLCI</li>
</ul>
</li>
</ul>
</div>
<div id="examples" class="section level3">
<h3 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h3>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">waterquality</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">raster</span>)
<span class="no">Harsha</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"raster/S2_Harsha.tif"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"waterquality"</span>))</pre></body></html></div>
<div id="single-algorithm" class="section level4">
<h4 class="hasAnchor">
<a href="#single-algorithm" class="anchor"></a>Single Algorithm</h4>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">Harsha_Am092Bsub</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/wq_calc.html">wq_calc</a></span>(<span class="kw">raster_stack</span> <span class="kw">=</span> <span class="no">Harsha</span>,
                            <span class="kw">alg</span> <span class="kw">=</span> <span class="st">"Am092Bsub"</span>,
                            <span class="kw">sat</span> <span class="kw">=</span> <span class="st">"sentinel2"</span>)</pre></body></html></div>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">Harsha_Am092Bsub</span>)</pre></body></html></div>
<p><img src="waterquality_vignette_files/figure-html/unnamed-chunk-3-1.png" width="384"></p>
</div>
<div id="multiple-algorithms" class="section level4">
<h4 class="hasAnchor">
<a href="#multiple-algorithms" class="anchor"></a>Multiple Algorithms</h4>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">Harsha_Multiple</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/wq_calc.html">wq_calc</a></span>(<span class="kw">raster_stack</span> <span class="kw">=</span> <span class="no">Harsha</span>,
                           <span class="kw">alg</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Am092Bsub"</span>, <span class="st">"Go04MCI"</span>, <span class="st">"Da052BDA"</span>),
                           <span class="kw">sat</span> <span class="kw">=</span> <span class="st">"sentinel2"</span>)</pre></body></html></div>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">Harsha_Multiple</span>)</pre></body></html></div>
<p><img src="waterquality_vignette_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
</div>
<div id="type-of-algorithm" class="section level4">
<h4 class="hasAnchor">
<a href="#type-of-algorithm" class="anchor"></a>Type of Algorithm</h4>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">Harsha_PC</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/wq_calc.html">wq_calc</a></span>(<span class="no">Harsha</span>,
                     <span class="kw">alg</span> <span class="kw">=</span> <span class="st">"phycocyanin"</span>,
                     <span class="kw">sat</span> <span class="kw">=</span> <span class="st">"sentinel2"</span>)</pre></body></html></div>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">Harsha_PC</span>)</pre></body></html></div>
<p><img src="waterquality_vignette_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
</div>
<div id="all-algorithms" class="section level4">
<h4 class="hasAnchor">
<a href="#all-algorithms" class="anchor"></a>All Algorithms</h4>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">Harsha_All</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/wq_calc.html">wq_calc</a></span>(<span class="no">Harsha</span>,
                      <span class="kw">alg</span> <span class="kw">=</span> <span class="st">"all"</span>,
                      <span class="kw">sat</span> <span class="kw">=</span> <span class="st">"sentinel2"</span>)</pre></body></html></div>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">Harsha_All</span>) <span class="co"># Only displays first 12 of 28</span></pre></body></html></div>
<p><img src="waterquality_vignette_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
</div>
</div>
</div>
<div id="mapping-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#mapping-functions" class="anchor"></a>Mapping Functions</h2>
<div id="map_wq_raster" class="section level3">
<h3 class="hasAnchor">
<a href="#map_wq_raster" class="anchor"></a>Map_WQ_raster</h3>
<p>This function wraps the <a href="https://cran.r-project.org/web/packages/tmap/tmap.pdf">“tmap”</a> package to help users generate an efficient map of their <code><a href="../reference/wq_calc.html">wq_calc()</a></code> raster output along with optional geospatial objects and histogram. In order to simplify this process and reduce the technical expertise required, we have reduced the number of arguments to the following:</p>
<p><code>WQ_raster</code> - Raster file generated from <code>wq_calc</code> or other GeoTiff file<br><code>sample_points</code> - geospatial file (.shp or .gpkg) containing sampling locations <code>map_title</code> - text used to generate title of map <code>raster_style</code> - method to process the color scale when col is a numeric variable. Please refer to the style argument in the ?tmap::tm_raster() function for more details (Default is “quantile”). <code>histogram</code> - Option to add or remove a histogram of the data values. (Default is TRUE)</p>
<div id="example" class="section level4">
<h4 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h4>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">waterquality</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">raster</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tmap</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sf</span>)
<span class="no">s2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"raster/S2_Harsha.tif"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"waterquality"</span>))
<span class="no">MM12NDCI</span> <span class="kw">=</span> <span class="fu"><a href="../reference/wq_calc.html">wq_calc</a></span>(<span class="no">s2</span>, <span class="kw">alg</span> <span class="kw">=</span> <span class="st">"MM12NDCI"</span>, <span class="kw">sat</span> <span class="kw">=</span> <span class="st">"sentinel2"</span>)
<span class="no">samples</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_read.html">st_read</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"raster/Harsha_Simple_Points_CRS.gpkg"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"waterquality"</span>))
<span class="no">lake_extent</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_read.html">st_read</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"raster/Harsha_Lake_CRS.gpkg"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"waterquality"</span>))</pre></body></html></div>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/Map_WQ_raster.html">Map_WQ_raster</a></span>(<span class="kw">WQ_raster</span> <span class="kw">=</span> <span class="no">MM12NDCI</span>,
              <span class="kw">sample_points</span> <span class="kw">=</span> <span class="no">samples</span>,
              <span class="kw">map_title</span><span class="kw">=</span> <span class="st">"Water Quality Map"</span>,
              <span class="kw">raster_style</span> <span class="kw">=</span> <span class="st">"quantile"</span>,
              <span class="kw">histogram</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="waterquality_vignette_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
</div>
</div>
<div id="map_wq_basemap" class="section level3">
<h3 class="hasAnchor">
<a href="#map_wq_basemap" class="anchor"></a>Map_WQ_basemap</h3>
<p>This function wraps the <a href="https://cran.r-project.org/web/packages/tmap/tmap.pdf">“tmap”</a> &amp; <a href="https://cran.r-project.org/web/packages/tmaptools/tmaptools.pdf">“tmaptools”</a> packages in order to generate a map using user-defined vectors (points and a polygon) overlaid on a Bing basemap. In order to simplify this process and reduce the technical expertise required, we have reduced the number of arguments to the following:</p>
<p><code>WQ_extent</code> - geospatial file (.shp or .gpkg) used to extract aerial imagery from Bing basemaps <code>WQ_parameter</code> - text referring to column heading of data being mapped (i.e. Chl-a, PC, etc.) <code>sample_points</code> - geospatial file (.shp or .gpkg) containing sampling locations <code>map_title</code> - text used to generate title of map <code>points_style</code> - method to process the color scale when col is a numeric variable. Please refer to the style argument in the ?tmap::tm_raster() function for more details (Default is “quantile”). <code>histogram</code> - Option to add or remove a histogram of the data values. (Default is TRUE)</p>
<div id="example-1" class="section level4">
<h4 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example</h4>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="../reference/Map_WQ_basemap.html">Map_WQ_basemap</a></span>(<span class="kw">WQ_extent</span> <span class="kw">=</span> <span class="no">lake_extent</span>,
              <span class="kw">sample_points</span> <span class="kw">=</span> <span class="no">samples</span>,
              <span class="kw">WQ_parameter</span> <span class="kw">=</span> <span class="st">"Chl_ugL"</span>,
              <span class="kw">map_title</span><span class="kw">=</span> <span class="st">"Water Quality Map"</span>,
              <span class="kw">points_style</span> <span class="kw">=</span> <span class="st">"quantile"</span>,
              <span class="kw">histogram</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="waterquality_vignette_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
</div>
</div>
</div>
<div id="acknowledgements" class="section level2">
<h2 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h2>
<p>The waterquality package was developed with funding from the U.S. Army Corps of Engineers. The authors would also like to thank the University of Cincinnati Library’s Research &amp; Data Services and the University of Cincinnati’s Space Informatics Lab for their expertise and technical services.</p>
</div>
<div id="credit" class="section level2">
<h2 class="hasAnchor">
<a href="#credit" class="anchor"></a>Credit</h2>
<p>To cite this library, please use the following entry:</p>
<p>Johansen R., Reif M., Emery E., Nowosad J., Beck R., Xu M., Liu H., waterquality: An Open-Source R Package for the Detection and Quantification of Cyanobacterial Harmful Algal Blooms and Water Quality. USACE ERDC/EL TR-19-20; DOI: 10.21079/11681/35053</p>
<p><span class="citation">@Article</span>{, author = {Richard Johansen and Molly Reif and Erich Emery and Jakub Nowosad and Richard Beck and Min Xu and Hongxing Liu}, title = {waterquality: An Open-Source R Package for the Detection and Quantification of Cyanobacterial Harmful Algal Blooms and Water Quality}, year = {2019}, doi = {10.21079/11681/35053}, journal = {USACE ERDC/EL TR-19-20}, }</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Richard Johansen, Jakub Nowosad, Molly Reif, Erich Emery, U.S. Army Corps of Engineers.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
